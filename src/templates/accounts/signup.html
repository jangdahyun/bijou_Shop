{% extends "base.html" %}
{% load static %}

{% block title %}Bijou | 회원가입{% endblock %}
{% block body_class %}page-signup{% endblock %}

{% block extra_css %}
<link rel="stylesheet" href="{% static 'accounts/signup.css' %}">
{% endblock %}

{% block content %}
<section class="auth auth--signup">
    <div class="auth__container">
        <div class="auth__panel">
            <div class="auth__panel-inner">
                <h1 class="auth__title">Create your Bijou account</h1>
                <p class="auth__subtitle">배송 정보와 맞춤 추천을 위해 필요한 내용을 입력해 주세요.</p>

                {% if messages%}
                    <ul class="messages">
                        {% for message in messages %}
                            <li{% if message.tags %} class="{{ message.tags }}"{% endif %}>{{ message }}</li>
                        {% endfor %}
                    </ul>
                {% endif %}

                <form method="post"
                      class="auth-form signup-form"
                      data-signup-form
                      data-verified="{{ verification_passed|yesno:'true,false' }}"
                      novalidate>
                    {% csrf_token %}
                    {{ form.non_field_errors }}

                    <div class="signup-form__grid">
                        <section class="signup-form__section">
                            <h2 class="signup-form__section-title">계정 정보</h2>

                            <div class="auth-form__field">
                                {{ form.username.label_tag }}
                                {{ form.username }}
                                {{ form.username.errors }}
                            </div>

                            <div class="auth-form__field">
                                {{ form.email.label_tag }}
                                {{ form.email }}
                                {{ form.email.errors }}
                            </div>

                            <div class="auth-form__field">
                                {{ form.password1.label_tag }}
                                {{ form.password1 }}
                                {{ form.password1.errors }}
                            </div>

                            <div class="auth-form__field">
                                {{ form.password2.label_tag }}
                                {{ form.password2 }}
                                {{ form.password2.errors }}
                            </div>
                        </section>

                        <section class="signup-form__section">
                            <h2 class="signup-form__section-title">회원 정보</h2>

                            <div class="auth-form__field">
                                {{ form.name.label_tag }}
                                {{ form.name }}
                                {{ form.name.errors }}
                            </div>

                            <div class="auth-form__field">
                                {{ form.birth_date.label_tag }}
                                {{ form.birth_date }}
                                {{ form.birth_date.errors }}
                            </div>

                            <div class="auth-form__field">
                                {{ form.phone.label_tag }}
                                {{ form.phone }}
                                {{ form.phone.errors }}
                            </div>

                            <div class="auth-form__field">
                                {{ form.address.label_tag }}
                                {{ form.address }}
                                {{ form.address.errors }}
                            </div>
                        </section>
                    </div>

                    <div class="signup-form__agreements">
                        <label class="signup-form__checkbox">
                            {{ form.terms_agreed }}
                            <span>필수 약관에 동의합니다.</span>
                        </label>
                        {{ form.terms_agreed.errors }}
                        <small class="signup-form__agreements-note">
                            가입을 진행하면 Bijou의 약관과 개인정보 처리방침에 동의한 것으로 간주됩니다.
                        </small>
                    </div>

                    <div class="signup-form__actions">
                        <button type="submit"
                                name="action"
                                value="send_code"
                                class="btn btn--primary auth-form__submit">
                        인증번호 발송
                        </button>
                    </div>

                    {% if show_verification %}
                    <div class="signup-form__verification">
                        <h3 class="signup-form__section-title">이메일 인증</h3>
                        {% if verification_passed %}
                            <p class="signup-form__verification-status success">
                                이메일 인증이 완료되었습니다. 아래 회원가입 버튼을 눌러 마무리해 주세요.
                            </p>
                        {% else %}
                            {{ verification_form.non_field_errors }}
                            <div class="auth-form__field">
                                {{ verification_form.code.label_tag }}
                                {{ verification_form.code }}
                                {{ verification_form.code.errors }}
                            </div>
                            <button type="submit"
                                    name="action"
                                    value="verify_code"
                                    class="btn btn--secondary">
                                인증번호 확인
                            </button>
                        {% endif %}
                    </div>
                    {% endif %}

                    <button type="submit"
                            name="action"
                            value="complete_signup"
                            class="btn btn--primary auth-form__submit"
                            data-complete-button
                            {% if not verification_passed %}hidden{% endif %}>
                        회원가입
                    </button>
                </form>

                <div class="auth__meta">
                    <span class="auth__meta-text">이미 계정이 있으신가요?</span>
                    <a class="auth__meta-link" href="{% url 'accounts:login' %}">로그인으로 돌아가기</a>
                </div>
            </div>
        </div>

        <div class="auth__visual auth__visual--signup">
            <div class="auth__visual-overlay"></div>
            <div class="auth__visual-content">
                <span class="auth__logo">BIJOU</span>
                <p class="auth__visual-text">
                    Bijou와 함께 라이프스타일을 완성하세요.<br>
                    오늘 가입하면 맞춤형 큐레이션과 빠른 배송을 바로 이용할 수 있습니다.
                </p>
                <ul class="signup-benefits">
                    <li>신규 회원 전용 10% 웰컴 쿠폰</li>
                    <li>취향 기반 실시간 추천 리포트</li>
                    <li>배송 현황을 한눈에 확인할 수 있는 대시보드</li>
                </ul>
            </div>
        </div>
    </div>
</section>
{% endblock %}

{% block extra_js %}
{{ block.super }}
<script src="{% static 'accounts/signup.js' %}"></script>
{% endblock %}
