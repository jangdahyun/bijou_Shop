{% extends "admin/base_site.html" %}
{% load static humanize %}

{% block content %}
{% with cards=dashboard.cards %}
<section class="dashboard">
    <header class="dashboard__header">
        <div>
            <h1 class="dashboard__title">운영 대시보드</h1>
            <p class="dashboard__subtitle">데이터 업데이트: {{ dashboard.generated_at|date:"Y년 n월 j일 H:i" }}</p>
        </div>
    </header>

    <section class="dashboard__stats">
        <article class="stat-card">
            <p class="stat-card__label">실시간 활성 회원</p>
            <p class="stat-card__value">{{ cards.active_users|intcomma }}</p>
            <p class="stat-card__hint">현재 활동 중인 계정 수</p>
        </article>
        <article class="stat-card">
            <p class="stat-card__label">이번 달 주문</p>
            <p class="stat-card__value">{{ cards.monthly_orders|intcomma }}</p>
            <p class="stat-card__hint">발생한 전체 주문 수</p>
        </article>
        <article class="stat-card">
            <p class="stat-card__label">확정 완료</p>
            <p class="stat-card__value">{{ cards.monthly_confirmed|intcomma }}</p>
            <p class="stat-card__hint">배송 완료된 주문 수</p>
        </article>
        <article class="stat-card stat-card--alert">
            <p class="stat-card__label">취소 · 환불</p>
            <p class="stat-card__value">{{ cards.monthly_canceled|intcomma }}</p>
            <p class="stat-card__hint">이번 달 취소·환불된 주문</p>
        </article>
        <article class="stat-card stat-card--wide">
            <div>
                <p class="stat-card__label">이번 달 매출</p>
                <p class="stat-card__value">₩{{ cards.monthly_sales|floatformat:0|intcomma }}</p>
            </div>
            <p class="stat-card__hint">결제 완료 기준 총 합계</p>
        </article>
    </section>

    <section class="dashboard__charts">
        <article class="chart-card">
            <header>
                <h2>이번 주 거래 금액 추이</h2>
                <span>일일 매출 합계</span>
            </header>
            <div class="chart-card__body">
                <canvas id="weeklySalesChart" aria-label="이번 주 거래 금액 그래프" role="img"></canvas>
            </div>
        </article>
        <article class="chart-card">
            <header>
                <h2>이번 주 카테고리 비중</h2>
                <span>카테고리별 매출 비율</span>
            </header>
            <div class="chart-card__body">
                <canvas id="categoryChart" aria-label="이번 주 카테고리별 거래 비율" role="img"></canvas>
                <div class="chart-card__empty" hidden>이번 주 카테고리 데이터가 없습니다.</div>
            </div>
        </article>
    </section>
</section>

{{ dashboard.weekly_sales|json_script:"weekly-sales-data" }}
{{ dashboard.weekly_category_distribution|json_script:"weekly-category-data" }}
{% endwith %}
{% endblock %}
